\chapter{Quantum Error Correction with GKP Codes\label{ch:2_QEC}}

It is sometimes said that the concept of quantum error correction is more remarkable than the concept of quantum computation itself \cite{girvin2019QECvideo}. Indeed, the fact that quantum error correction is in principle even possible is somewhat surprising, for three fundamental reasons: (1) the \textit{no-cloning} theorem \cite{ike-and-mike}, which forbids us from copying unknown quantum states to naively add redundancy; (2) the \textit{measurement problem}, also known as Born's rule, whereby measuring a quantum state causes it to collapse due to measurement backaction; and (3) errors on quantum states can be continuous-valued and are thus in some sense analog. Despite these somewhat severe restrictions imposed by quantum mechanics, quantum error correction (QEC) can still be realized. 


In this thesis, we are concerned with a specific class of quantum error correcting codes called \textit{bosonic codes}, which store information in continuous-variable degrees of freedom of a quantum harmonic oscillator \cite{terhal2020bosonic, cai2021bosonic, joshi2021bosonic}. Bosonic codes offer a hardware-efficient alternative to the traditional qubit-based register codes, such as the surface code, and are thus interesting for practical QEC implementations. Among the various bosonic codes that exist, we will specifically focus on the so-called Gottesman-Kitaev-Preskill (GKP) grid code and the requirements for its realization in experiment. In this chapter, we will introduce the basic notions of bosonic QEC and the GKP code, study specific theoretical proposals for error correction of the GKP codewords, and discuss how to implement the basic conditional displacement operation required for GKP QEC.

\section{Overview of Bosonic Error Correction}
\subsection{Definitions and Notation \label{sec:2_BosonicQEC_Definitions}}
Here, we collect various definitions and identities from quantum optics that will be relevant to the discussion of bosonic QEC. Additional details can be found in Refs. \cite{shankar1994principles, raimond2006exploring, grynberg2010introduction}. We begin with an overview of the quantum harmonic oscillator, which is defined in terms of generalized position $\hat{x}$ and momentum $\hat{p}$ operators satisfying the commutation relation $[\hat{x}, \hat{p}] \equiv \hat{x}\hat{p} - \hat{p}\hat{x} = i\h$. The quantum Hamiltonian is given by
\begin{equation}
    \hat{H} = \frac{\hat{p}^2}{2m} + \frac{1}{2}m\omega^2 \hat{x}^2
\end{equation}
where $m$ denotes the mass and $\omega$ is the natural frequency \cite{shankar1994principles}. This is fully analogous to the classical Hamiltonian of a harmonic oscillator that we might study in a course on classical mechanics. In the quantum case, however, the oscillator will have quantized energy levels, which can be seen by introducing mode operators $\hat{a}, \hat{a}^\dagger$ that diagonalize the Hamiltonian:
\begin{align}
\begin{split}
     \hat{x} &= \sqrt{\frac{\h}{2m\omega}}(\hat{a} + \hat{a}^\dagger) \,\triangleq\, x_{\rm zpf} (\hat{a} + \hat{a}^\dagger) \\
     \hat{p} &= i\sqrt{\frac{m\h\omega}{2}}(\hat{a}^\dagger - \hat{a}) \,\triangleq\, \frac{i}{2x_{\rm zpf}} (\hat{a}^\dagger - \hat{a})
\end{split}
\end{align}
The commutation relation between $\hat{x}$ and $\hat{p}$ translates into an important condition: $[\hat{a}, \hat{a}^\dagger] = 1$. With these definitions\footnote{In quantum optics, it is common to set $m, \omega, \h \to 1$ so that $x_{\rm zpf} \to 1/\sqrt{2}$ by convention. This isn't necessary, but sometimes helps to abstract away from the picture of a mechanical oscillator in theory calculations.} in place, the harmonic oscillator Hamiltonian above takes on the simple form: 
\begin{equation}
    \hat{H} = \h\omega\bigg(\hat{a}^\dagger\hat{a} + \frac{1}{2}\bigg) \,\triangleq\, \h\omega\bigg(\hat{n} + \frac{1}{2}\bigg)
\end{equation}
Here, we have defined the photon number operator $\hat{n} = \hat{a}^\dagger\hat{a}$ which tells us how many excitation quanta occupy an oscillator state. The energy eigenstates $\ket{n}$ (also known as \textit{Fock} states) satisfy $\hat{n}\ket{n} = n\ket{n}$, and thus the oscillator Hamiltonian satisfies $\hat{H}\ket{n} = E_n\ket{n}$ with energy levels $E_n = \h\omega(n + 1/2)$. The constant term $\h\omega/2$ is known as the zero-point energy; we mostly ignore it so that the oscillator Hamiltonian simplifies to just $\hat{H} = \h\omega \hat{a}^\dagger\hat{a}$. The mode operators $\hat{a}^\dagger, \hat{a}$ are referred to as \textit{creation} and \textit{anniliation} operators, since they act on Fock states via
\begin{equation}
    \hat{a}^\dagger\ket{n} = \sqrt{n+1}\ket{n+1}, \quad \hat{a}\ket{n} = \sqrt{n}\ket{n}.
\end{equation}
The Fock states $\{\ket{n}\}_{n=0}^\infty$ can be shown to form a basis for the formally infinite-dimensional Hilbert space $\mathcal{H}$ of a single oscillator mode; thus, $\ip{m}{n} = \delta_{n, m}$ and $\sum_n \op{n}{n} = \hat{I}$, where $\delta_{n, m}$ is the Kronecker delta and $\hat{I}$ is the identity operator on $\mathcal{H}$. 

In analogy with a classical oscillator, we can also define the \textit{position} and \textit{momentum} states of the quantum harmonic oscillator via the set of non-normalizable eigenstates $\ket{x}$ and $\ket{p}$, which satisfy $\hat{x}\ket{x} = x\ket{x}$ and $\hat{p}\ket{p} = p\ket{p}$ for $x, p \in \R$. These continuous-variable oscillator states satisfy
\begin{equation}
    \int_{x \in \R} \op{x}{x}dx = \int_{p \in \R} \op{p}{p} dp = \hat{I}
\end{equation}
and, like any conjugate pair of variables in quantum mechanics, can be related via Fourier transform: $\ket{x} = \frac{1}{\sqrt{2\pi}} \int_p dp e^{-ipq}\ket{p}$. One important set of identities the eigenstates $\ket{x}$ and $\ket{p}$ is the following: 
\begin{equation}
    e^{-iu\hat{p}}\ket{x} = \ket{x + u}, \quad e^{iv\hat{x}}\ket{p} = \ket{p+v}
\end{equation}
Effectively, the operators $\exp(-iu\hat{p})$ and $\exp(iv\hat{x})$ enable us to shift the position and momentum of the oscillator by $u$ and $v$ respectively. We can combine both into a quadrature displacement operator $\hat{D}(u, v) \equiv \exp(iv\hat{x} - iu\hat{p})$. Setting $\alpha = (u+iv)/\sqrt{2}$, we can then define the phase-space displacement operator $\hat{D}(\alpha) \equiv \hat{D}(u, v)$ as follows: 
\begin{equation}
    \hat{D}(\alpha) = \exp(\hat{a}^\dagger \alpha - \alpha^\ast \hat{a})
\end{equation}
Written in this canonical form, the displacement operator has several useful identities. In particular,  we have $\hat{D}^\dagger(\alpha) = \hat{D}(-\alpha)$ and $\hat{D}^\dagger(\alpha) \hat{a} \hat{D}(\alpha) = \hat{a} + \alpha$. The displacement operator also generates so-called \textit{coherent states} $\ket{\alpha} \equiv \hat{D}(\alpha)\ket{0}$ when operated on the vacuum state $\ket{0}$. These coherent states are eigenstates of $\hat{a}$, satisfying $\hat{a}\ket{\alpha} = \alpha\ket{\alpha}$, and can be explicitly constructed via:
\begin{equation}
    \ket{\alpha} = e^{-|\alpha|^2/2}\sum_{n=0}^\infty \frac{\alpha^n}{\sqrt{n!}} \ket{n}
\end{equation}

\noindent \textbf{Visualizing oscillator states.} In this section, we have introduced Fock states and coherent states as two important classes of oscillator states. For more general mixed states, we also typically represent oscillator states using a density matrix $\rho$. However, by far the most intuitive way to describe and visualize bosonic states is to use a phase-space quasiprobability distribution. One of the most common is the symmetric characteristic function $C(\beta)$, defined via: 
\begin{equation}
    C(\beta) = \ev{\hat{D}(\beta)} = \Tr[\rho \hat{D}(\beta)] 
\end{equation}
By taking the two-dimensional Fourier transform of this function in phase space, we arrive at the Wigner function
\begin{equation}
    W(\alpha) = \frac{1}{\pi^2}\int C(\beta) e^{\alpha\beta^\ast - \alpha^\ast\beta} d^2\beta
\end{equation}
By plotting $W(\alpha)$ as a function of $x = \sqrt{2}\mathrm{Re}(\alpha)$ and $p = \sqrt{2}\mathrm{Im}(\alpha)$, we can visualize an oscillator state $\rho$ in phase space. We show examples for certain Fock and coherent states in Fig. \ref{fig:2_Fock_Wigners} below. 

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{Figures/2/Fock_Wigners.pdf}
    \caption{Simulated Wigner functions for the oscillator Fock states $\ket{0}$, $\ket{1}$, $\ket{2}$, $\ket{3}$, as well as a coherent state $\ket{\alpha}$ with $\alpha = 2 + 2i$. }
    \label{fig:2_Fock_Wigners}
\end{figure}

The Wigner function has several useful mathematical properties. It integrates to unity, i.e. so that $\int W(x, p)dxdp = 1$ when expressed in terms of $x$ and $p$. Furthermore, we have marginals
\begin{equation}
    \int W(x, p)dx = |\psi(x)|^2, \qquad \int W(x, p)dp = |\psi(p)|^2
\end{equation}
and thus can also calculate position and momentum wavefunctions from the Wigner function. Finally, we have:
\begin{equation}
    W(\alpha) = \frac{2}{\pi}\Tr\big[\hat{D}(-\alpha)\hat{\rho}\hat{D}(\alpha)\hat{\Pi}]
\end{equation}
where $\hat{\Pi} = (-1)^{\hat{a}^\dagger\hat{a}}$ is the so-called parity operator \cite{royer1977wigner}. From this, we see that $|W(\alpha)| \leq 2/\pi$. Moreover, in practice, this gives an easy way to compute Wigner functions in circuit QED since the parity operator is something that we can quite easily measure \cite{sun2014tracking}. 


\subsection{Control, Nonlinearity, and Auxiliary Qubits\label{sec:2_control_nonlinearity_drive}}
In circuit QED, we usually control a harmonic oscillator by subjecting it to a microwave drive on one of its quadratures \cite{manenti2023quantum}. Specifically, we end up implementing a Hamiltonian of the form:
\begin{equation}
    \hat{H}(t) = \hat{H}_{\rm QHO} + \hat{H}_d(t) = \omega_a \hat{a}^\dagger \hat{a} + \epsilon(t)(\hat{a} + \hat{a}^\dagger)\cos(\omega t)
    \label{eq:2_oscillator_drive}
\end{equation}
consisting of a bare quantum harmonic oscillator (note that we have set $\h \to 1$, to equate energies and frequencies here), as well as a drive Hamiltonian $\hat{H}_d(t)$ that modulates one of the quadratures, i.e. $\hat{x} \sim \hat{a} + \hat{a}^\dagger$ in this case\footnote{Later in our chapter on circuit QED, it will be more typical to couple to the $\hat{p} \sim i(\hat{a}^\dagger - \hat{a})$, which corresponds to the ``charge'' of the electrical implementation of the quantum harmonic oscillator, known as an LC circuit.}. Typically, this is only form of control that we can implement over a linear oscillator, and as we will now see, results in a displacement of the oscillator in phase space. In order to drive excitations of the system, we ideally want a resonant drive (as we did for the qubit), i.e. so that $\omega = \omega_a$. In this case, we can transform to the so-called \textbf{rotating frame} via the unitary operator $\hat{U}(t) = \exp[-i\omega t\hat{a}^\dagger \hat{a}]$ to analyze the dynamics. Since we have not yet encountered this concept in this thesis, let's now discuss it. Essentially, we can think of $\hat{U}(t)$ as a change of basis, i.e. a canonical transformation to a moving frame of reference where the quadrature axes of phase space are now themselves also rotating at frequency $\omega$. In our case, working in the ``Heisenberg picture'' of quantum mechanics at the level of operators, the effect of the time-dependent unitary $\hat{U}(t)$ is to map the Hamiltonian
\begin{equation}
    \hat{H} \mapsto \hat{U} \hat{H} \hat{U}^\dagger + i[\partial_t \hat{U}]\hat{U}^\dagger
\end{equation}
where the first term captures the change of basis and the second term is a time-dependent correction in this frame; it is analogous to, for example, a Coriolis force that arises when moving to a non-inertial frame of reference in classical mechanics \cite{goldstein-classical-mechanics}. 

Returning now to our treatment of drives in an oscillator, we can now analyze the driven QHO via:
\begin{equation}
    \hat{H}(t) \mapsto \hat{H}_{\rm rot}(t) = (\omega_a - \omega)\hat{a}^\dagger \hat{a} + \epsilon(t)(\hat{a} e^{-i\omega t} + \hat{a}^\dagger e^{i\omega t})\cos(\omega t)
\end{equation}
in the rotating frame, where $\hat{U}(t)$ has the effect of transforming $\hat{a} \mapsto a e^{-i\omega t}$. When $\omega = \omega_a$, the frame-dependent correction term exactly cancels with the bare oscillator Hamiltonian $\hat{H}_{\rm QHO}$. Meanwhile, by expanding $\cos(\omega t) = (e^{i\omega t} + e^{-i\omega t})/2$, we see that the resulting drive term will have a static component and components rotating with frequencies $e^{\pm 2i\omega t}$. In the resonant case we are in, these terms will be fast-oscillating and highly off resonant; we can thus often neglect them, making the famous rotating-wave approximation (RWA)\footnote{The RWA works very well in many cases, but also has its limits where the so-called counter-rotating terms at frequencies $\pm 2\omega$ cannot be ignored. We will return to the RWA many more times throughout this thesis.}. If we do this here, we are left with
\begin{equation}
    \hat{H}_{\rm rot} = \frac{\epsilon(t)}{2} \big(\hat{a} + \hat{a}^\dagger\big)
\end{equation}
where the only remaining time-dependence is the slow variation of the drive \textit{envelope} $\epsilon(t)$. If we now solve the Schr\"odinger equation $i\partial_t \ket{\psi} = \hat{H}_{\rm rot}\ket{\psi}$ with this Hamiltonian using a constant drive $\epsilon(t) = \epsilon_0$, we get the expected unitary evolution $\ket{\psi(t)} = \hat{U}_{\rm p}(t) \ket{\psi(0)}$ with the propagator given by $\hat{U}_{\rm p}(t) = \exp[-i\hat{H}_{\rm rot} t]$. We can confirm that this has the form of an oscillator displacement
\begin{equation}
    \hat{U}_{\rm p}(t) = e^{-i\epsilon_0 t(\hat{a} + \hat{a}^\dagger)/2} = \hat{D}\bigg(\frac{-i\epsilon_0 t}{2}\bigg)
\end{equation}
from which we conclude that any initial oscillator state will simply just be displaced under the action of a resonant drive. In particular, starting from the vacuum state $\ket{0}$, we have no way to prepare the Fock $\ket{1}$ state, since all higher energy levels of a linear oscillator by definition have the same frequency spacing $\omega_a$ as the $\ket{0}\to\ket{1}$ transition. Given this, it is not immediately clear how we can realize universal control and prepare nontrivial states of the oscillator for the purpose of bosonic quantum error correction.

It turns out the solution to this is to \textit{introduce} some form of nonlinearity into the oscillator, typically by coupling it to some auxiliary nonlinear element such as a two-level qubit/spin \cite{cai2021bosonic, raimond2006exploring, haroche2020cavity, blais2021circuit}. This approach was pioneered in Cavity QED experiments in the 1990s and later adopted by circuit QED. We can get an intuitive understanding by considering the basic foundational model for coupling an oscillator to a qubit, known as the Jaynes-Cummings Hamiltonian \cite{raimond2006exploring}:
\begin{equation}
    \hat{H}_{\rm JC} = \omega_a \hat{a}^\dagger\hat{a} + \frac{\omega_q}{2}\sigmaz + g(\hat{a}^\dagger\sigmam + \hat{a}\sigmap)
\end{equation}
Here, the interaction is mediated via an operator that swaps excitations between the qubit and the oscillator. In circuit QED, we usually work in the off-resonant regime $g \ll |\omega_a - \omega_q|$; but if we briefly imagine somehow bringing the qubit into resonance with the oscillator, we are left with $g(\hat{a}^\dagger\sigmam + \hat{a}\sigmap)$ in the interaction frame. Loosely speaking, we can populate the qubit (which, due to its inherent nonlinearity, may be done using just a resonant drive), and then swap the excitation to the oscillator via the exchange interaction. If we repeat this many times, we can imagine ``climbing the ladder'' of Fock levels to to prepare nontrivial states of the joint qubit-oscillator system \cite{krause1989preparation, meystre1990cat, vogel1993quantum}. In fact, this was one of the first methods for realizing universal control over an oscillator \cite{law1996arbitrary}. 

Of course, this intuitive explanation relies on the resonant Jaynes-Cummings interaction and thus does not work in the more typical \textit{dispersive regime} where the oscillator and qubit are far-detuned, i.e. $g \ll |\omega_a - \omega_q|$. In this case, however, it is possible to approximate the Jaynes-Cummings Hamiltonian by treating the interaction as a perturbation and going to second-order in perturbation theory \cite{raimond2006exploring}. Doing this leaves with us the effective dispersive Hamiltonian
\begin{equation}
    \hat{H}_{\rm disp} = \omega_a \hat{a}^\dagger\hat{a} + \frac{\omega_q}{2}\sigmaz + \frac{\chi}{2}\hat{a}^\dagger\hat{a}\sigmaz
    \label{eq:2_dispersive_model_qubit}
\end{equation}
where the so-called \textit{dispersive shift} $\chi$ is defined here as $\chi = 2g^2/(\omega_q - \omega_a)$ and we have absorbed a Lamb shift $\omega_q \to \omega_q + g^2/(\omega_q - \omega_a)$. There is a lot to be said about Eq. \eqref{eq:2_dispersive_model_qubit}, as it is arguably the foundation on which almost all of modern circuit QED is built \cite{blais2004cavity}. The basic idea is that the effective oscillator frequency $\omega_a + \chi\sigmaz/2$ now depends on the qubit state via $\ev{\sigmaz}$, and in particular results in two different frequencies $\omega_a \pm \chi/2$ for when the qubit is in state $\ket{g}$ or $\ket{e}$ respectively. Equivalently, by regrouping the terms in Eq. \eqref{eq:2_dispersive_model_qubit} another way, the effective qubit frequency $(\omega_q + \chi \hat{a}^\dagger\hat{a})/2$ depends on the average number of photons $\ev{\hat{a}^\dagger\hat{a}}$ in the oscillator. The former grouping gives us a blueprint for the so-called \textit{dispersive readout} of a qubit, through which one may determine the qubit state just by measuring the frequency of a resonator that it is coupled to. We will return to this idea again later in this thesis, such as when we discuss circuit QED in Ch. \ref{ch:3_cQED} and when we present our experimentals in Ch. \ref{ch:4_3DGKP}. 

Finally, returning to the question of oscillator state preparation for bosonic QEC, it turns out that it is possible to achieve universal control over the joint qubit and oscillator Hilbert space just by using the dispersive interaction together with arbitrary single-qubit rotations and oscillator displacements \cite{vlastakis2015controlling, reinhold2019controlling, eickbusch2022fast}. We will discuss the specific control requirements for QEC with the GKP code in the coming sections. 

\subsection{Oscillator Error Mechanisms}

Up until now, we have not yet formally discussed why oscillators may be a good platform for implementing QEC. The reason for this turns out to be that physical quantum harmonic oscillators have a particular simple set of loss channels: single-photon loss and dephasing. In superconducting resonators, the dephasing rate $\kappa_\phi$ can be an order of magnitude smaller than the single-photon loss rate $\kappa_1$ and thus we refer to single-photon loss as the dominant error mechanism. 

At short times, the effect of photon loss can be described via a Kraus map on the density matrix $\hat{\rho}$ of the oscillator. Specifically, at short times, we can write the evolution $\hat{\rho}(t + \delta t)$ using a Kraus map
\begin{equation}
    \hat{\rho}(t + \delta t) = \mathcal{E}_{\rm loss}\big[\hat{\rho}(t)] \triangleq \sum_{\ell = 0}^\infty  \hat{E}_\ell \rho(t)  \hat{E}_\ell^\dagger
\end{equation}
where the photon loss Kraus operators $ \hat{E}_\ell$ are defined in terms of $\kappa_1$ via $\gamma = 1 - e^{-\kappa_1 \delta t}$ and have the form \cite{albert2018performance-and-structure}:
\begin{equation}
    \hat{E}_\ell = \bigg(\frac{\gamma}{1 - \gamma}\bigg)^{\ell/2} \frac{\hat{a}^\ell}{\sqrt{\ell !}} (1 - \gamma)^{\hat{n}/2}
\end{equation}
When the single-photon loss rate $\kappa_1$ or time-step $\delta t$ are small, we can approximate $\gamma \approx \kappa_1 \delta t$ and consider only:
\begin{equation}
    \hat{E}_0 \approx \hat{I} - \frac{\kappa_1 \delta t}{2}\hat{a}^\dagger\hat{a}, \quad \hat{E}_1 \approx \sqrt{\kappa_1 \delta t}\hat{a}
\end{equation}
Therefore, 
\begin{equation}
    \hat{\rho}(t + \delta t) \approx \kappa_1\delta t\bigg[\hat{a}\hat{\rho}(t)\hat{a}^\dagger - \frac{1}{2}\Big(\hat{a}^\dagger\hat{a}\hat{\rho}(t) + \hat{\rho}(t)\hat{a}^\dagger\hat{a}\Big)\bigg] + \mathcal{O}(\delta t^2)
\end{equation}
From here, we can formally write down a differential equation for the density matrix that is subject to single-photon loss. If we further include a Hamiltonian evolution $\partial_t \hat{\rho} = i[\hat{H}, \hat{\rho}]$ on top of this, we get
\begin{equation}
    \frac{d}{dt}\hat{\rho}(t) = i[\hat{H}, \hat{\rho}] + \kappa_1\mathcal{D}[\hat{a}](\hat{\rho})
    \label{eq:2_lindblad_photon_loss}
\end{equation}
where the dissipation superoperator is defined as $\mathcal{D}[\hat{a}](\cdot) = \hat{a}\cdot\hat{a}^\dagger - \frac{1}{2}\{\hat{a}^\dagger\hat{a}, \cdot\}$. We will refer to Eq. \eqref{eq:2_lindblad_photon_loss} as the Lindblad master equation, in this case for single-photon loss $\hat{a}$. For the kinds of error channels we consider in this thesis, the evolution will always take the form of a Lindblad equation, with the error operator specified by the type of loss. In particular, cavity dephasing can be described\footnote{The intuition for this is that dephasing arises from frequency fluctuations of an oscillator. Its Hamiltonian is $[\omega_0 + \delta \omega(t)]\hat{a}^\dagger\hat{a}$, which we can decompose into the bare term $\omega_0 \hat{a}^\dagger\hat{a}$ and a noisy fluctuator $\delta \omega(t)\hat{a}^\dagger\hat{a}$ that couples to the operator $\hat{a}^\dagger\hat{a}$. The same reasoning applies to qubits, whose dephasing is specified by $\sigmaz$.} by the operator $\hat{a}^\dagger\hat{a}$ and will thus result in the master equation 
\begin{equation}
    \frac{d}{dt}\hat{\rho}(t) = i[\hat{H}, \hat{\rho}] + \kappa_\phi\mathcal{D}[\hat{a}^\dagger\hat{a}](\hat{\rho})
\end{equation}
with dephasing rate $\kappa_\phi$. Moreover, later on in this chapter, we will also consider errors in a control qubit that is dispersively coupled to the oscillator via the operator $\frac{\chi}{2}\hat{a}^\dagger\hat{a}\sigmaz$. Here too, the continuous evolution of the system under the qubit loss channels can be described by the equation:
\begin{equation}
    \frac{d}{dt}\hat{\rho}_{aq}(t) = i[\hat{H}, \hat{\rho}_{aq}] + \gamma_1\mathcal{D}[\sigmax](\hat{\rho}_{aq}) + \gamma_\phi\mathcal{D}[\sigmaz](\hat{\rho}_{aq})
\end{equation}
where now the Hamiltonian and density matrix $\hat{\rho}_{aq}$ are for the joint qubit-oscillator system. Here, we have included qubit bit-flip errors at rate $\gamma_1 = 1/T_1$ via the bit-flip operator $\sigmax$ and qubit dephasing errors at rate $\gamma_\phi = 1/T_\phi$ via the phase-flip operator $\sigmaz$. Given that bit-flips and phase-flips are generated by the qubit operators $\sigmax$ and $\sigmaz$ respectively, we might now see why bit-flip errors are particularly harmful for bosonic codes (more so than phase-flip errors). Any bosonic system with a dispersively coupled qubit and oscillator will have an interaction that is mediated via the coupling term $\hat{H}_{\rm int} = \frac{\chi}{2}\hat{a}^\dagger\hat{a}\sigmaz$. Observe that phase-flips commute with this interaction: $[\hat{H}_{\rm int}, \sigmaz] = 0$ and thus a phase flip error on the qubit will, to leading order, be invisible to the oscillator. Of course, this may propagate further and cause losses, but the leading effect is that oscillators should be insensitive to phase-flips. By contrast $[\hat{H}_{\rm int}, \sigmax] \neq 0$, which in turn means that a control qubit bit-flip \textit{can} cause backaction on the oscillator state. The specific mechanism by which this occurs will depend on the details of the bosonic code and the particular QEC protocol being used; nonetheless, it can be said that control qubit bit-flip errors are a broad problem for bosonic codes. This is what motivates us to use a bit-flip protected control qubit (heavy fluxonium) in our experiments, as we will later see in Chapters \ref{ch:4_3DGKP} and \ref{ch:5_2DGKP}. 

\clearpage
\section{A Brief Introduction to GKP Grid Codes\label{sec:2_Intro_to_GKP}}

The Gottesman-Kitaev-Preskill (GKP) grid code is a bosonic encoding that embeds a logical qubit nonlocally within the phase space of a harmonic oscillator. While the code itself has been known for two decades since the original proposal by Gottesman, Kitaev, and Preskill \cite{gottesman2001gkp} in 2001, it was only recently realized experimentally in trapped ions \cite{fluhmann2019gkp-expt, deneeve2022gkp-expt} and superconducting circuits \cite{campagne2020gkp-expt, sivak2023gkp-expt, nordquantique2023gkp-expt}. In this section, we will introduce the basic theory of the GKP code as well as its finite-energy counterpart, and then discuss the various components required for their experimental realization. 

\subsection{Ideal GKP Codes}
In general, GKP codes are defined by a lattice in the $(2N)$-dimensional phase space of $N$ quantum harmonic oscillators \cite{gottesman2001gkp, royer2022multimodegkp}. In this thesis, however, we will focus on the simplest case of a single oscillator ($N=1$) whose phase space is described by the quadrature coordinates $\hat{x}$ and $\hat{p}$ as discussed in Sec. \ref{sec:2_BosonicQEC_Definitions}. Following the original proposal of Gottesman, Kitaev, and Preskill, we can consider the square lattice with lattice constant $\ells = 2\sqrt{\pi}$ formed by the quadratures $\hat{x}$ and $\hat{p}$. The ideal GKP codewords associated with this lattice are defined as the simultaneous $+1$ eigenstates of the following two stabilizer operators: 
\begin{equation}
    \hat{S}_0^X = e^{-i\ells\hat{p}} = \hat{D}(\ell) , \qquad \hat{S}_0^Z = e^{i\ells\hat{x}} = \hat{D}(i\ell)
\end{equation}
Here, we have also defined the reduced lattice constant $\ell = \ells/\sqrt{2} = \sqrt{2\pi}$ as the \textit{phase space} displacement associated with the \textit{quadrature} (i.e. $x$ or $p$) displacement $\ell_s$. We can therefore write down the canonical GKP codewords directly. They are given by the $\hat{x}$ basis states:
\begin{equation}
    \ket{0_L} \propto \sum_{j \in \Z} \ket{x = j\ells}, \qquad \ket{1_L} \propto \sum_{j \in \Z} \ket{x = (j + 1/2)\ells}.
    \label{eq:GKP_codewords_ideal}
\end{equation}
Together, these two codewords form a two-dimensional logical subspace $\mathcal{C} \equiv \{\ket{0_L}, \ket{1_L}\}$ within the infinite-dimensional Hilbert space $\mathcal{H}$ of the oscillator. We plot wavefunctions for the codewords of Eq. \eqref{eq:GKP_codewords_ideal} in Fig. \ref{fig:2_GKP_Ideal_Wavefunctions}, which consist of a sum of Dirac delta functions. Here, we refer to the code states $\ket{0_L/1_L}$ as $\ket{\pm Z_L}$ instead, in reference to the logical Bloch sphere of the GKP qubit. (We will later show Wigner functions for all six cardinal states $\ket{\pm X_L}$, $\ket{\pm Y_L}$, $\ket{\pm Z_L}$ of this Bloch sphere, in the finite-energy case; see Fig. \ref{fig:2_GKP_Codewords}). From the ideal wavefunctions, however, we can verify that the stabilizers should indeed bring the codewords back to themselves: $\hat{S}_0^X\ket{\mu_L} = \hat{S}_0^Z\ket{\mu_L} = \ket{\mu_L}$ for $\mu\in\{0, 1\}$. The former can be seen directly on Fig. \ref{fig:2_GKP_Ideal_Wavefunctions}, while the latter requires us to plot the momentum wavefunctions (or full Wigner). Furthermore, we also see that logical Pauli operators can be implemented via displacements of half the lattice constant: 
\begin{figure}[t]
    \centering
    \includegraphics[width=0.85\linewidth]{Figures/2/GKP_Ideal_Wavefunctions.pdf}
    \caption{Position-basis wavefunctions for the ideal GKP codewords $\ket{0_L/1_L} = \ket{\pm Z_L}$.}
    \label{fig:2_GKP_Ideal_Wavefunctions}
\end{figure}
\begin{equation}
    \hat{X}_L^0 = \sqrt{\hat{S}_0^X} =  e^{-i\ells\hat{p}/2} , \qquad \hat{Z}_L^0 = \sqrt{\hat{S}_0^Z} = e^{i\ells\hat{x}/2}. 
\end{equation}

At this point, we might ask how the GKP states introduced above can be used for QEC. As originally proposed, the GKP code was designed to correct error channels that manifest as small phase space displacements of the oscillator, i.e. $(x, p) \to (x + \delta_x/\sqrt{2}, p+\delta_p/\sqrt{2})$. The basic principle is as follows: observe that $[\hat{S}_0^Z, \hat{S}_0^X] = [e^{i\ells\hat{x}}, e^{-i\ells\hat{p}}] = 0$, i.e. the two GKP stabilizers commute and we can measure them simultaneously in their joint eigenbasis. This in turn implies that it is possible to measure $\hat{x}$ and $\hat{p}$ simultaneously as long as both are taken modulo $\ells/2$\footnote{Following \cite{royer2020gkp}, we will sometimes refer to the modular quadratures $\hat{x}_{[m]} \equiv \hat{x} \Mod m$ and $\hat{p}_{[m]} \equiv \hat{p} \Mod m$ with a symmetric modulo, i.e. $\hat{x}_{[m]}, \hat{p}_{[m]} \in [-m/2, m/2)$. We are specifically interested in $\hat{x}_{[\ells/2]}$ and $\hat{p}_{[\ells/2]}$.}. Therefore, if a displacement error shifts the GKP grid by an amount $(x, p) \to (x + \delta_x/\sqrt{2}, p+\delta_p/\sqrt{2})$, we can simply measure the modular quadratures and then apply a correction operation $\hat{D}(-\alpha)$ with $\alpha = \delta_x + i\delta_p$ to re-center the grid. If the errors are small, i.e. $|\delta_x|, |\delta_p| < \ell / 4$ (now expressed in terms of the \textit{phase space} grid), this results in a perfect recovery of the logical information. We depict this process in Fig. \ref{fig:2-GKP-Ideal-QEC}(a) showing the effect of a displacement error on the full Wigner function of the code (which, as expected, has the form of a 2D grid in phase space). Now, it turns out that for realistic oscillators, most physical decoherence processes such as single-photon loss or dephasing occur via a continuous distortion of phase space. This means that these error mechanisms can be corrected by the GKP code if the GKP stabilizers are measured frequently enough \cite{gottesman2001gkp, glancy2006gkperror, albert2018performance-and-structure, noh2018performance-and-structure-pt2}. Among the various single-mode bosonic codes, it was recently shown that the GKP code offers the best protection against photon loss, which is the dominant error mechanism for superconducting resonators \cite{albert2018performance-and-structure}. 
\begin{figure}[h]
    \centering
    \includegraphics[width=0.85\linewidth]{Figures/2/GKP Ideal QEC.pdf}
    \caption{\textbf{(a)} Wigner function for GKP $|0_L\rangle$ state under the effect of a small displacement $\delta = \delta_x + i\delta_p$. We plot the Wigner in phase space coordinates ${\rm Re}(\alpha)$ and ${\rm Im}(\alpha)$. If the error is small $|\delta_x|, |\delta_p| < \ell / 4$ (purple box), we can correct the error exactly. \textbf{(b,c)} Stabilizer circuit for GKP QEC which uses a conditional displacement to map error information to the phase of a control qubit. We plot this phase along the equator of the control qubit Bloch sphere.}
    \label{fig:2-GKP-Ideal-QEC}
\end{figure}

For an ideal GKP code, the actual stabilizer measurements can be carried out by using an auxiliary qubit as shown in Fig. \ref{fig:2-GKP-Ideal-QEC}(b). This QEC circuit maps the stabilizer information onto the phase of the qubit using a conditional displacement operation
\begin{equation}
    {\rm CD}(\ell) = \hat{D}\bigg(\frac{+\ell}{2}\bigg)\op{g}{g} + \hat{D}\bigg(\frac{-\ell}{2}\bigg)\op{e}{e} = \exp[\ell(\hat{a}^\dagger - \hat{a}) \sigmaz / 2].
    \label{eq:2_CD_unitary_definition}
\end{equation}
From the perspective of the oscillator, the CD gate implements a displacement conditioned on the state of the qubit; meanwhile, from the perspective of the qubit, this same operation can be seen as a rotation about the $z$-axis of the Bloch sphere by an amount $\ev{\hat{a}^\dagger - \hat{a}}\ell/2$. If the oscillator has suffered a displacement by $\delta = \delta_x + i\delta_p$, the circuit in Fig. \ref{fig:2-GKP-Ideal-QEC}(b) has the the effect of imparting a phase proportional to $\delta_x/\ell$ onto the qubit. By then measuring the qubit, we can use a one-bit phase estimation to determine $\delta_x$ bit-by-bit; we then perform intermediate small displacements to continuously correct this over many rounds of repeated stabilizer measurements \cite{terhal2016phase-estimation, terhal2020bosonic}. We of course must also interleave this with conditional displacements along the other quadrature $i\ell$ to extract the error $\delta_p$. Intuitively, however, we can think of this QEC process as continuously measuring the quadratures $x$ and $p$ modulo $\ells$ and applying feedback displacements to correct the small displacement errors that arise. 

\clearpage

\subsection{Finite-Energy GKP Codes}

While the ideal GKP codewords $\ket{\mu_L}$ make clear how the grid code can be used for error correction, it remains to be seen how to realize them in practice. On their own, the states $\ket{\mu_L}$ are non-normalizable superpositions of infinitely squeezed states that extend across the entire phase space of the oscillator; they contain infinite energy and so cannot actually be realized in the lab. Moreover, for realistic systems with loss such as those we encounter in cQED, it is simply not feasible to have an arbitrarily large energy state in the oscillator. The reason for this is that the rates of various physical error channels scale with the number of photons/excitations. For example, amplitude damping where the photon loss rate $\Gamma_n$ with which the Fock state $\ket{n}$ decays to $\ket{n-1}$ scales as $\Gamma_n = n\Gamma_1$, where $\Gamma_1$ is the single-photon loss rate. Another example is the self-Kerr nonlinearity that a resonator inherits from its coupling to any nonlinear auxiliary control element (cf. Chapter \ref{ch:3_cQED}). To remedy the situation above, it is necessary to bound the squeezing of the GKP states and limit their extent in phase space. Furthermore, one must design error correction strategies that maintain the oscillator photon number so that such errors do not accumulate over time \cite{campagne2020gkp-expt}. We can realize physical, finite-energy GKP states by applying an envelope operator $\hat{E}_\Delta$ to the codewords \cite{royer2020gkp}. A natural choice is a Gaussian envelope $\hat{E}_\Delta = \exp(-\Delta^2 \hat{a}^\dagger\hat{a})$, which gives the individual peaks of the GKP states a finite width $\Delta$ while also applying an overall Gaussian envelope of width $1/\Delta$ to the entire grid. We define the finite-energy GKP codewords as 
\begin{equation}
    \ket{\tilde{\mu}_L} = \mathcal{N}_\Delta \hat{E}_\Delta \ket{\mu_L}
\end{equation}
for $\mu \in \{0, 1\}$, where $\mathcal{N}_\Delta$ is a normalization factor. These approximate GKP states $\ket{\tilde{\mu}_L}$ are non-orthogonal for non-zero $\Delta$, and are also no longer eigenstates of the ideal stabilizers $\hat{S}_0^{X/Z}$. However, it turns out that it is still possible to define exact stabilizers for the finite-energy code
\begin{equation}
    \hat{S}_\Delta^{X/Z} = \hat{E}_\Delta\,\hat{S}_0^{X/Z}\,\hat{E}_\Delta^{-1}
\end{equation}
which, by construction, satisfy $\hat{S}_\Delta^{X/Z}\ket{\tilde{\mu}_L} = \ket{\tilde{\mu}_L}$. We can similarly define regularized logical Pauli operators $\hat{X}_L^\Delta = \hat{E}_\Delta \hat{X}_L^0 \hat{E}_\Delta^{-1}$ and $\hat{Z}_L^\Delta = \hat{E}_\Delta \hat{Z}_L^0 \hat{E}_\Delta^{-1}$ via the same transformation. Clearly, as $\Delta \to 0$, the finite-energy GKP states and operators will approach their ideal infinite-energy counterparts, albeit at the expense of a higher average photon number in the codewords 
\begin{equation}
    \bar{n}_{\rm GKP} = \frac{1}{2} \sum_{\mu\in \{0,1\}} \mel{\tilde{\mu}_L}{\hat{a}^\dagger\hat{a}}{\tilde{\mu}_L} \approx \frac{1}{2\Delta^2} - \frac{1}{2}
\end{equation}
and the detrimental effects that come with it. Conversely, increasing $\Delta$ too much results in a non-negligible loss in fidelity due to the increasing finite overlap $\ip{\tilde{0}_L}{\tilde{1}_L}$, and in general reduces the code's ability to correct errors \cite{royer2020gkp}. We can therefore view $\Delta$ as a controllable parameter which determines the `size' of the GKP code, and whose value can be optimized in experiment. 

%\footnote{For realistic resonators in circuit QED with significant single-photon loss, it is often best to use a low number of oscillator photons (e.g. $\bar{n}_{\rm GKP} \lesssim 5$). Recent GKP experiments in Refs. \cite{sivak2023gkp-expt} and \cite{nordquantique2023gkp-expt} used $\Delta = 0.34$ and $\Delta = 0.36$ respectively, corresponding to roughly 3-4 photons. As the quality of resonators improves, so too will this tradeoff.}.


\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{Figures/2/GKP_Wigners_Delta.pdf}
    \caption{Simulated Wigner functions for the finite-energy GKP codewords $\ket{\tilde{0}_L}$/$\ket{\tilde{1}_L}$ as a function of the parameter $\Delta$, which sets the width of the individual peaks as well as the overall extent of the grid in phase space via $1/\Delta$. The associated mean photon numbers $n_{\rm GKP}$ are approximately 200, 22, 7.5, and 3.6, respectively, as $\Delta$ increases.}
    \label{fig:2_GKP_Wigners_Delta}
\end{figure}

\begin{figure}
    \centering
    \includegraphics[width=0.8\linewidth]{Figures/2/GKP_Codewords.pdf}
    \caption{Simulated Wigner functions and associated wavefunctions for the six cardinal states of the logical GKP Bloch sphere: \textbf{(a)} $\ket{\pm \tilde{Z}_L}$, \textbf{(b)} $\ket{\pm \tilde{X}_L}$, and \textbf{(c)} $\ket{\pm \tilde{Y}_L}$. Here we have chosen the finite-energy envelope $\Delta = 0.2$, and we plot Wigners vs. the quadratures $(x, p)$.}
    \label{fig:2_GKP_Codewords}
\end{figure}
\clearpage

\section{Open-Loop GKP Error Correction \label{sec:2_OpenLoopGKPQEC}}

In circuit QED, there are various approach one could take to simply \textit{prepare} GKP states, e.g. via optimal control protocols such as GRAPE \cite{khaneja2005grape, reinhold2019thesis}, SNAP \cite{krastanov2015-SNAP, heeres2015-SNAP, fosel2020-SNAP}, or ECD \cite{eickbusch2022fast}; via periodic (Floquet) driving in a SQUID \cite{gkp-periodic-drive2024}; or by engineering superconducting circuits with GKP-like ground states \cite{rymarz2021hardwaregkp}. However, we are generally more interested in protocols that prepare \textit{and} continuously stabilize GKP states via stabilizer measurements and active error correction. For ideal GKP codewords, we saw how to do this with phase estimation in Fig. \ref{fig:2-GKP-Ideal-QEC}. On the other hand, for realistic GKP codewords in practice, we need to measure the corresponding stabilizers $\hat{S}_\Delta^{X/Z}$ instead. It turns that this is possible to do by modifying the circuit in Fig. \ref{fig:2-GKP-Ideal-QEC} to account for the finite-energy envelope \cite{fluhmann2019gkp-expt, campagne2020gkp-expt, royer2020gkp, deneeve2022gkp-expt}; furthermore, QEC can be realized ``autonomously'' by replacing the measurement-based feedback step with an unconditional qubit reset. More precisely, we refer to this as \textit{open-loop} error correction (in the language of control theory) to distinguish it from QEC based on feedback control. To arrive at this result, it ends up being helpful to take a different view of the QEC process as a form of engineered dissipation \cite{royer2020gkp, vlad2023thesis}. In this picture, errors can be described as excitations out of the GKP code manifold; error correction then entails realizing a dissipative quantum channel to `cool' these excitations and stabilize the code space. Following the theoretical treatment in Ref. \cite{royer2020gkp}, the desired dissipation channel on the oscillator can be decomposed as an interaction between the oscillator and an auxiliary qubit that is reset after each round of cooling (error correction), i.e. effectively transferring entropy out of the system. We refer the reader to Refs. \cite{royer2020gkp, sivak2023gkp-expt, vlad2023thesis} for a rigorous derivation and discussion of this theory\footnote{We also point out Refs. \cite{sellem2023gkp, sellem2024gkp} which introduce an entirely different dissipation channel for the GKP code, though the main idea there is also to autonomously stabilize the code space albeit with more dissipators.}, and here instead just convey the main result. Based on different Trotter decompositions of the generalized dissipation channel in \cite{royer2020gkp}, there are actually several candidate qubit-oscillator circuits/protocols that can realize open-loop QEC of the finite-energy GKP code. In this thesis, we work primarily with the Small-Big-Small (SBS) protocol\footnote{The other two protocols are called Sharpen-Trim (ST) and Big-Small-Big (BSB). Both require two large CD gates, and ST also has two reset steps. Meanwhile SBS requires just one of each (see next section).}, shown below. 
\begin{figure}[h]
    \centering
    \includegraphics[width=0.85\linewidth]{Figures/2/SBS.pdf}
    \caption{Gate sequence for the Small-Big-Small (SBS) error correction protocol, which consists of interleaved qubit rotations and oscillator conditional displacements, followed by qubit reset. QEC is implemented via repeated application of this sequence and its complement (the latter having displacements $\beta \to i\beta$ on all CDs). See text for details.}
    \label{fig:2-SBS}
\end{figure}

\subsection{The Small-Big-Small (SBS) Protocol\label{sec:2_SBS}}
\textbf{Overview.} The SBS circuit consists of three conditional displacement gates interleaved by qubit rotations. The middle CD involves a large phase space displacement of magnitude $c_\Delta \ell \approx \ell$, and it effectively realizes phase estimation to measure the GKP stabilizer. Here we have defined $c_\Delta \equiv \cosh(\Delta^2)$, and note that $c_\Delta \approx 1$ for all practical values ($\Delta \lesssim 0.4$) of the GKP size. Meanwhile, the first and last CD operations are smaller corrections that account for the finite-energy envelope and perform autonomous error correction respectively (see e.g. \href{https://youtu.be/TOQzHkgsH_E?t=1045}{this talk}). From theory, we have $\epsilon_1 = s_\Delta \ell$ with $s_\Delta \equiv \sinh(\Delta^2) \approx \Delta^2$, and we nominally expect $\epsilon_2 = \epsilon_1$. However, in Ref. \cite{sivak2023gkp-expt}, the authors optimized the two small displacements independently and found, through use of a reinforcement learning (RL) agent, that choosing $\epsilon_2 \gtrsim \epsilon_1$ gave the best QEC performance. This observation has since been corroborated in simulation when accounting for all error channels acting during the SBS unitary, and was also reported in another experiment \cite{nordquantique2023gkp-expt}. Essentially, although $\epsilon_1 = \epsilon_2$ holds for a lossless circuit, when including loss the optimal ratio $\epsilon_2/\epsilon_1$ turns out to be strongly dependent on the actual error channels involved, and is thus another free parameter (like $\Delta$) that can be tweaked in experiment to get the best QEC gain. Finally, it is important to note that the circuit above carries out phase estimation for the $\hat{S}_\Delta^{Z}$ stabilizer; to get the circuit for the $\hat{S}_\Delta^{X}$ stabilizer, we just map ${\rm CD}(\beta) \to {\rm CD}(i\beta)$. The full QEC sequence for SBS then involves repeatedly alternating between the two circuits to stabilize both quadratures. 

\noindent \textbf{Kraus Operators for SBS.} We can describe the SBS protocol in a more quantitative manner by considering it as a quantum channel. To this end, let us imagine that the SBS reset step is implemented using measurement-based active reset. In this case, although the oscillator QEC is still `autonomous', we would have access to the error syndromes by looking at the measurement statistics of the qubit. A subtle yet interesting feature of the circuit above is that---in the absence of errors---it leaves the qubit and oscillator completely disentangled after the unitary evolution (gray box in Fig. \ref{fig:2-SBS}). Thus, if no error occurs, the qubit state will end up in $\ket{g}$ before reset. In our current measurement-based reset approach, then, a measurement outcome $\ket{g}$ would signify ``no error'' while a measurement outcome $\ket{e}$ would imply that an error was detected and corrected. Based on these two outcomes, we can write down the action of the SBS circuit above on just the oscillator by evolving a full qubit-oscillator state through the circuit and then finally tracing out the qubit. This leaves us with a pair of Kraus operators $\hat{K}_g^Z, \hat{K}_e^Z$ for the oscillator, which are given by\footnote{I owe a huge thanks to Jonathan Pelletier for his help deriving these expressions for the general case $\epsilon_1 \neq \epsilon_2$.}:     
\begin{align}
    \begin{split}
        \hat{K}_g^Z &= \cos\bigg(\frac{\epsilon_2 \sqrt{\pi}}{2\sqrt{2}}\bigg)\Bigg[\cos\bigg(\frac{\epsilon_2 + \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\cos(\sqrt{\pi} \hat{x}) + i\sin\bigg(\frac{\epsilon_2 - \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\sin(\sqrt{\pi} \hat{x})\Bigg] \\
        &\quad + \sin\bigg(\frac{\epsilon_2 \sqrt{\pi}}{2\sqrt{2}}\bigg)\Bigg[\cos\bigg(\frac{\epsilon_2 - \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\cos(\sqrt{\pi} \hat{x}) - i\sin\bigg(\frac{\epsilon_2 + \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\sin(\sqrt{\pi} \hat{x})\Bigg]
    \end{split} \\
    \begin{split}
        \hat{K}_e^Z &= -\cos\bigg(\frac{\epsilon_2 \sqrt{\pi}}{2\sqrt{2}}\bigg)\Bigg[i\sin\bigg(\frac{\epsilon_2 + \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\cos(\sqrt{\pi} \hat{x}) + \cos\bigg(\frac{\epsilon_2 - \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\sin(\sqrt{\pi} \hat{x})\Bigg] \\
        &\quad -\sin\bigg(\frac{\epsilon_2 \sqrt{\pi}}{2\sqrt{2}}\bigg)\Bigg[i\sin\bigg(\frac{\epsilon_2 - \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\cos(\sqrt{\pi} \hat{x}) - \cos\bigg(\frac{\epsilon_2 + \epsilon_1}{2\sqrt{2}} \hat{p}\bigg)\sin(\sqrt{\pi} \hat{x})\Bigg]
    \end{split}
\end{align}
For an input state $\hat{\rho}\otimes \op{+}{+}$ to the SBS circuit, the oscillator state $\hat{\rho}$ after unitary evolution and reset is given by
\begin{equation}
    \hat{\rho} \mapsto \mathcal{R}_\Delta^Z(\hat{\rho}) = \hat{K}_g^Z \hat{\rho} \hat{K}_g^Z{}^\dagger + \hat{K}_e^Z \hat{\rho} \hat{K}_e^Z{}^\dagger  
\end{equation}
where $\mathcal{R}_\Delta^Z$ is the rank-2 dissipator towards the $+1$ eigenspace of $\hat{S}_\Delta^Z$. To get the equivalent dissipator $\mathcal{R}_\Delta^X$ for the stabilizer $\hat{S}_\Delta^X$, we can map $\hat{K}_{g/e}^Z \to \hat{K}_{g/e}^X$ by making the replacement $(x, p) \to (p, -x)$. Finally, the quantum channel for the full SBS QEC cycle is $\mathcal{R}_\Delta = \mathcal{R}_\Delta^X \circ \mathcal{R}_\Delta^Z$. 

In practice, we envision in our experiments using a fully unconditional qubit reset rather than measurement-based feedback. In this case, we won't have access to the measurement statistics (i.e. the protocol will be truly \textit{open-loop}). Furthermore, the final qubit Hadamard gate can be omitted from the protocol and absorbed into the reset operation. Nonetheless, for theoretical analysis and certain numerical simulations, it will make things considerably easier to continue working in the artificial measurement-based feedback picture using the Kraus operators for SBS.

\noindent\textbf{Logical Pauli Measurements.} Quantum error correction with the SBS protocol consists of multiple rounds of the circuit from Fig. \ref{fig:2-SBS}, which we saw can be expressed as a quantum channel for the oscillator state in terms of the Kraus operators $\hat{K}_{g/e}^{Z}$ and $\hat{K}_{g/e}^{X}$ above. It will also turn out to be useful to define similar operations to describe logical \textit{measurements}, i.e. measuring $\hat{X}_L^\Delta$, $\hat{Y}_L^\Delta$, and $\hat{Z}_L^\Delta$ within the GKP codespace. These are also derived in Ref. \cite{royer2020gkp} and can be expressed as follows. To measure $\hat{X}_L^\Delta$, $\hat{Y}_L^\Delta$, or $\hat{Z}_L^\Delta$ respectively for a given joint qubit-oscillator state $\hat{\rho}_{aq}$, we first apply one of three unitaries $\hat{M}_x$, $\hat{M}_y$, or $\hat{M}_z$ and then measure the qubit in the $z$-basis. The operators are defined in terms of $\epsilon = s_\Delta \ells$ as follows:
\begin{align}
    \begin{split}
        \hat{M}_x &= e^{-i\ell_s c_\Delta \hat{p}\sigmax / 4} e^{i \epsilon \hat{x}\sigmay/4} \\
        \hat{M}_y &= e^{-i\ell_s c_\Delta (\hat{x}+\hat{p})\sigmax / 4} e^{i \epsilon (\hat{x}-\hat{p})\sigmay/4} \\
        \hat{M}_z &= e^{-i\ell_s c_\Delta \hat{x}\sigmax / 4} e^{-i \epsilon \hat{p}\sigmay/4}
    \end{split}
\end{align}
To see an example of this in practice, we demonstrate a numerical simulation of SBS QEC in Fig. \ref{fig:2_SBS_NoLoss_QEC_Sim} below. Here, we consider the case of no error channels  and thus starting from an initial oscillator state $\hat{\rho}_0$ each round of SBS can be described via the application of the two QEC channels
\begin{equation}
    \hat{\rho}_{i + 1} = (\mathcal{R}_\Delta^X \circ \mathcal{R}_\Delta^Z)(\hat{\rho}_i) = \mathcal{R}_\Delta^X\Big[\mathcal{R}_\Delta^Z(\hat{\rho}_i)\Big]
\end{equation}
i.e. each QEC round consists of stabilizing both $X$ and $Z$. We start from the vacuum state $\hat{\rho}_0 = \op{0}{0}$ in the oscillator and perform 30 rounds of SBS (15 rounds of QEC). Over time, we see the the oscillator converges towards the GKP code manifold, and after 30 rounds the oscillator state is approximately $\hat{\rho} \approx \frac{1}{2}\op{+\tilde{Z}_L}{+\tilde{Z}_L} + \frac{1}{2}\op{+\tilde{X}_L}{+\tilde{X}_L}$. This is because our initial vacuum state $\ket{0}$ has support over both even parity GKP cardinal states $+X_L$/+$Z_L$. 

After round 30, we perform a projective measurement of $\hat{Z}_L^\Delta$ within the codespace via the operator $\hat{M}_z$. This involves first mapping the oscillator state $\hat{\rho} \mapsto \hat{\rho}_{aq} = \hat{M}_z(\hat{\rho}\otimes \op{g}{g})\hat{M}_z^\dagger$, and then projecting onto the measurement outcome of measuring $\ket{g}$ in the qubit, which is done using the projector $\hat{I}_a \otimes \op{g}{g}$. Specifically, we map $\hat{\rho}_{aq} \mapsto (\hat{I}_a \otimes \op{g}{g}) \hat{\rho}_{aq}(\hat{I}_a \otimes \op{g}{g})$, normalize, and then trace out the qubit to get an oscillator-only state $\hat{\rho}_z$ after measurement. Choosing the outcome $\ket{g}$ results in this final oscillator state $\hat{\rho}_z \approx \ket{+\tilde{Z}_L}$; if we had chosen $\ket{e}$, we would end up with a state close to $\ket{-\tilde{Z}_L}$. After the measurement, we continue stabilizing with 30 more rounds of SBS, which brings us closer to the true codeword $\hat{\rho} \to \ket{+\tilde{Z}_L}$. We plot this entire process in Fig. \ref{fig:2_SBS_NoLoss_QEC_Sim} showing the expectation value $\ev{\hat{Z}_L^\Delta}$ as a function of time, as well as the oscillator Wigner functions for (i) the initial state $\hat{\rho}_0$, (ii) the state before measurement, and (iii) the final state $\approx \ket{+Z_L^\Delta}$. 

\begin{figure}[h]
    \centering
    \includegraphics[width=0.85\linewidth]{Figures/2/SBS_NoLoss_QEC_Sim.pdf}
    \caption{Plot of expectation value $\ev{\hat{Z}_L^\Delta}$ vs. time over multiple rounds of SBS. We see the oscillator state converge to the GKP code manifold over 30 rounds of SBS. At round 30, we perform a logical projective measurement of $\hat{Z}_L^\Delta$, and then continue with 30 additional rounds of SBS. The oscillator state converges to the codeword $\hat{\rho} \to \ket{+\tilde{Z}_L}$ as shown by the final Wigner function. We also plot the Wigner functions for the initial vacuum state and the intermediate state before the logical measurement. Note $\Delta = 0.25$ and $\epsilon_1 = \epsilon_2$ here.}
    \label{fig:2_SBS_NoLoss_QEC_Sim}
\end{figure}

\subsection{SBS with Oscillator Single-Photon Loss}
Following up from the ideal stabilization case in Fig. \ref{fig:2_SBS_NoLoss_QEC_Sim} above, we can also examine what happens during SBS error correction when there is single-photon loss on the oscillator. In this case, we define \begin{equation}
    \hat{\rho}_{i + 1} =  \mathcal{E}_{\rm loss}\Big(\mathcal{R}_\Delta^X\Big[\mathcal{E}_{\rm loss}\Big(\mathcal{R}_\Delta^Z(\hat{\rho}_i)\Big)\Big]\Big)
    \label{eq:2_SBS_Lossy_Kraus}
\end{equation}
i.e. we interleave the single-photon loss channel $\mathcal{E}_{\rm loss}$ with the error correction channels. We demonstrate an example of evolving an oscillator vacuum state $\ket{0}$ under this equation in Fig. \ref{fig:2_SBS_Lossy_QEC_Sim}, setting $\Delta = 0.25$ and $\epsilon_1 = \epsilon_2$ for the GKP code and $\kappa_1\delta t = 8\times 10^{-3}$ for the loss.
\begin{figure}[h]
    \centering
    \includegraphics[width=0.85\linewidth]{Figures/2/SBS_Lossy_QEC_Sim.pdf}
    \caption{Plot of expectation value $\ev{\hat{Z}_L^\Delta}$ vs. time over multiple rounds of SBS. We take $\Delta = 0.25$ and $\epsilon_1 = \epsilon_2$ for the GKP code, and set $\kappa_1\delta t = 8\times 10^{-3}$. Starting from the vacuum state, we first converge to the codespace over 30 rounds, perform a logical measurement of $\hat{Z}_L^\Delta$, and then stabilize for another 30 rounds. Due to the single-photon loss, we see $\ev{\hat{Z}_L^\Delta}$ decay exponentially with time. Compared to Fig. \ref{fig:2_SBS_NoLoss_QEC_Sim}, the contrast of the Wigner functions is also reduced here due to the effect of the loss on the stabilization.}
    \label{fig:2_SBS_Lossy_QEC_Sim}
\end{figure}

Note that the single-photon loss channel $\mathcal{E}_{\rm loss}$ is entirely specified in terms of the product $\kappa_1\delta t$, where $\delta t$ is a period over which we accrue loss. The evolution modelled by Eq. \eqref{eq:2_SBS_Lossy_Kraus} is thus one of instantaneous QEC channels interleaved by periods $\delta t$ of photon loss, which is meant to approximate the true error correction process occurring continuously over the period $\delta t$. One could also perform a full master equation simulation [cf. Eq. \eqref{eq:2_lindblad_photon_loss}] of the SBS gate sequence in Fig. \ref{fig:2-SBS}, but this will give similar results for small $k_1\delta t$. 

The SBS evolution shown here in Fig. \ref{fig:2_SBS_Lossy_QEC_Sim} is only meant to be an illustrative example of the GKP error correction process, showing what happens when QEC and single-photon loss both occur simultaneously. We will demonstrate more extensive such simulations in Ch. \ref{ch:5_2DGKP}, where we sweep over various amounts of single-photon loss $\kappa_1\delta t$. In those simulations, we will actually fit the exponential decay of $\ev{\hat{Z}_L^\Delta}$ with time to extract the lifetime $T_{\ket{+Z}}$ for the state $\ket{+\tilde{Z}_L}$. To give a preview, in the simulation we show in Ch. \ref{ch:5_2DGKP}, we will then repeat this QEC process to prepare all six cardinal states $\ket{\pm \tilde{Z}_L}$, $\ket{\pm \tilde{X}_L}$, $\ket{\pm \tilde{Y}_L}$ of the GKP logical Bloch sphere. From there, we can calculate $T_Z = \frac{1}{2}[T_{\ket{+Z}} + T_{\ket{-Z}}]$, and likewise for $X$ and $Y$, to finally get
\begin{equation}
    T_L = 3\bigg(\frac{1}{T_X} + \frac{1}{T_Y} + \frac{1}{T_Z}\bigg)^{-1}
\end{equation}
as the total logical lifetime of the GKP qubit averaged over all six cardinal states \cite{royer2020gkp, sivak2023gkp-expt}. In Ch. \ref{ch:5_2DGKP}, our simulation will consist of then optimizing over the GKP code parameters $\Delta$, $\epsilon_1$ and $\epsilon_2$ in order to maximize the logical lifetime $T_L$ for any given value of single-photon loss. 






\clearpage
\section{Implementing Conditional Displacements in Theory}

As we saw in Secs. \ref{sec:2_Intro_to_GKP} and \ref{sec:2_OpenLoopGKPQEC} above, the condition displacement is an essential ingredient for GKP error correction. Therefore, in this section, we will  outline some commonly-used approaches that one can take to realize conditional displacement gates at the Hamiltonian level. The starting point for our discussion is the so-called spin-boson or ``quantum Rabi'' model defined by \cite{hagelstein2004introductory}:
\begin{equation}
\hat{H} = \frac{\omega_q}{2}\sigmaz + \omega_a \hat{a}^\dagger \hat{a} + g\sigmax\big(\hat{a} + \hat{a}^\dagger)
\label{eq:2_QuantumRabiModel_H}
\end{equation}
This Hamiltonian captures the fundamental light-matter interaction between an oscillator and a two-level atom, and it is a model that we will return to and refine when we discuss superconducting qubits and circuit QED in Ch. \ref{ch:3_cQED}. As a brief aside, in the resonant case of $\omega_a \simeq \omega_q$, it is possible to approximate Eq. \eqref{eq:2_QuantumRabiModel_H} by the Jaynes-Cummings model that we saw in Sec. \ref{sec:2_control_nonlinearity_drive}, which has a modified excitation-conserving coupling term $g(\hat{\sigma}_+\hat{a} + \hat{\sigma}_-\hat{a}^\dagger)$; we get to this by expanding $\sigmax = \sigmap + \sigmam$ and performing a rotating-wave approximation to neglect counter-rotating terms [i.e. those that remain fast-oscillating when we move to the rotating frame]. The Rabi model with its dipole coupling $g\sigmax\big(\hat{a} + \hat{a}^\dagger)$ is thus, in a sense, more fundamental than than Jaynes-Cummings model, the latter being an approximation of the former. In what follows, we will highlight whenever the RWA is invoked.

\subsection{Cross-Resonance Style Conditional Displacement Gates}

Within the general qubit-oscillator model of Eq. \eqref{eq:2_QuantumRabiModel_H}, we can generate an effective conditional displacement (CD) interaction $\hat{H}_{\rm CD} = g_{\rm CD}(\hat{a} + \hat{a}^\dagger)\sigmaz$ by coherently driving the qubit at the frequency of the oscillator \cite{touzard2019gated}. We call this a ``cross-resonance'' style CD as the operation principle is identical to that of the cross-resonance gate between two qubits \cite{rigetti2010fully}, in which we start from the static two-qubit Hamiltonian $\hat{H} = \hat{H}_a + \hat{H}_b + g\sigmax^a\sigmax^b$ and drive qubit $b$ at the frequency of qubit $a$ to get an effective interaction of the form  $\hat{H}_{\rm CR} = g_{\rm CR}\sigma_x^a\sigma_z^b$, which is the same as $\hat{H}_{\rm CD}$ if we truncate the oscillator to its lowest levels $\hat{a} + \hat{a}^\dagger \to \sigma_x^a$. In this sense, it does not matter what modes $a$ and $b$ are (i.e. qubits or oscillators) and so the following derivation can be done for any kind of qubit mode $b$, e.g. a fluxonium qubit or a transmon as was considered in Ref. \cite{touzard2019gated}. Here, however, we will present the simplest case of a two-level qubit. We start with the Hamiltonian of Eq. \eqref{eq:2_QuantumRabiModel_H} and add to it a drive term:
\begin{equation}
\hat{H}_0(t) = \frac{\omega_q}{2}\sigmaz + \omega_a \hat{a}^\dagger \hat{a} + g\sigmax\big(\hat{a} + \hat{a}^\dagger) + \Omega \cos(\omega t)\sigmax
\label{eq:CR_CR_initial_eq}
\end{equation}
Here, the phenomenological drive term is of similar nature to the oscillator drives we saw in Sec. \ref{sec:2_control_nonlinearity_drive}. We can transfer the time-dependence of the drive to the coupling by moving to a rotating frame of the qubit at the drive frequency $\omega$. This is done via a unitary operator $\hat{U}_1(t) = \exp[i\omega t \sigmaz / 2] = \cos(\omega t/2)\I +i\sin(\omega t/2)\sigmaz$ to map $\hat{H}_0(t) \mapsto \hat{H}_1 = \hat{U}_1\hat{H}_0\hat{U}_1^\dagger + i[\partial_t \hat{U}_1]\hat{U}_1^\dagger$. We can do this transformation term-by-term  via $\hat{U}_1\sigmax\hat{U}_1^\dagger = \cos(\omega t)\sigmax - \sin(\omega t)\sigmay$ and, since $\sigmaz$ and $\hat{U}_1$ commute, $\hat{U}_1\sigmaz\hat{U}_1^\dagger = \sigmaz$. Defining the detuning $\delta_q = \omega_q - \omega$, the new Hamiltonian is then: 
\begin{equation}
H_1^{\rm RWA} = \frac{\delta_q}{2}\sigmaz + \frac{\Omega}{2}\sigmax + \omega_a \hat{a}^\dagger \hat{a} + g\big[\cos(\omega t)\sigmax - \sin(\omega t)\sigmay\big]\big(\hat{a} + \hat{a}^\dagger)
\end{equation}
Here, we have made a rotating-wave approximation (RWA) to simplify\footnote{We can compare to Sec. \ref{sec:2_control_nonlinearity_drive} and consider the replacement $\sigmam \to b$ and $\sigmap\to b^\dagger$. Since $\sigmaz = 1-2\sigmap\sigmam$, we can then think of $\hat{U}_1(t)$ like an oscillator rotating frame transformation $\hat{U}_1(t) = \exp[-i\omega t \sigmap\sigmam]$ which maps $\sigmam \mapsto \sigmam e^{i\omega t}$. This is fully equivalent to the action of $\hat{U}_1$ on the other Paulis above. After the RWA, the simplified drive term reads $(\Omega/2)[\sigmam + \sigmap] = (\Omega/2)\sigmax$. Using intuition from oscillators to reason about qubit frame transformations is an important trick to keep in our toolbox, whenever it is rigorously allowed!} the drive term from $\Omega \cos(\omega t)\sigmax \to (\Omega/2)[\sigmam e^{-i\omega t} + \sigmap e^{i\omega t}]$, i.e. dropping fast oscillating terms at frequencies $\pm 2\omega$. Following \cite{rigetti2010fully}, we can now rotate the quantization axis specified by $(\delta_q\sigmaz + \Omega\sigmaz)/2$ onto the qubit's X-axis via the static rotation $\hat{U}_2 = \exp[-i\xi_q\sigmay/2]$ by an angle $\xi_q = \tan^{-1}(\delta_q/\Omega)$. The qubit then sees an effective field of $\eta_q = (\delta_q^2 + \Omega^2)^{1/2}$ along its new axis of quantization (the X-axis), i.e. $(\delta_q\sigmaz + \Omega\sigmaz)/2 \mapsto \eta_q\sigmax/2$. The rotated Hamiltonian is
\begin{equation}
\hat{H}_2 = \frac{\eta_q}{2}\sigmax + \omega_a \hat{a}^\dagger \hat{a} + g\Big[\cos(\omega t)\big[\cos(\xi_q)\sigmax -\sin(\xi_q)\sigmaz\big]- \sin(\omega t)\sigmay\Big]\big(\hat{a} + \hat{a}^\dagger)
\end{equation}
in this new frame. At this point, we can further move into a jointly rotating frame to get
\begin{align}
\begin{split}
H_3(t) = g\bigg[\cos(\omega t)\Big\{\cos(\xi_q)\sigma_x -\sin(\xi_a)\big[\cos(\eta_q t)\sigma_z + \sin(\eta_q t)\sigma_y\big]\Big\} \\ - \sin(\omega t)\big[\cos(\eta_q t)\sigma_y - \sin(\eta_q t)\sigma_z\big]\bigg]\cdot\Big(a e^{-i\omega_a t} + a^\dagger e^{i\omega_a t}\Big)
\end{split}
\end{align}
where we specifically transform to a rotating frame at frequency $\eta_q$ for the qubit and $\omega_a$ for the oscillator via unitaries $\hat{U}_3^q(t)$ and $\hat{U}_3^a(t)$ (not shown). At \textit{this} point, we can perform the main RWA of this derivation. We set $\omega = \omega_a$ (driving the qubit at the resonator frequency) and rewrite  $\hat{a} e^{-i\omega_a t} + \hat{a}^\dagger e^{i\omega_a t} = (\hat{a}+\hat{a}^\dagger)\cos(\omega_a t) + i(\hat{a}^\dagger - \hat{a})\sin(\omega_a t)$ for ease of averaging, noting that the RWA here amounts to replacing $\cos(\omega t)\cos(\omega t) \to \frac{1}{2}$ and $\cos(\omega t)\sin(\omega t) \to 0$. Doing this gives
\begin{equation}
\hat{H}_{3, \rm\, eff} = \frac{g\cos(\xi_q)}{2} \sigmax\big(\hat{a}+ \hat{a}^\dagger)
\end{equation}
since this is the only static term that survives the averaging. While this is an effective ``XX'' type coupling, we should remember that we are in a non-standard frame of reference for the qubit. We thus revert the transformation $\hat{U}_2$ to realign with the correct quantization axis, giving:
\begin{equation}
\hat{H}_4 =    \frac{g\cos(\xi_q)}{2} \Big[\cos(\xi_q)\sigmax +\sin(\xi_q)\sigmaz\Big]\big(\hat{a}+\hat{a}^\dagger\big)
\end{equation}
Finally, since the drive is set to $\omega = \omega_a$, we get $\delta_q \triangleq \omega_q - \omega_a = \Delta$, i.e. the detuning between the qubit and the resonator, which in most experimental settings we expect to be large. In this case, $\cos^2(\xi_q)= \Omega^2 / [\Omega^2 + \Delta^2] \approx (\Omega/\Delta)^2$, which quickly goes to zero in the limit of $\Delta$ being large, i.e. $\Omega \ll |\Delta|$. Meanwhile, $\cos(\xi_a)\sin(\xi_a)= \Omega_a\Delta / [\Omega_a^2 + \Delta^2] \approx \Omega_a /\Delta$. Therefore, we are left with
\begin{equation}
\hat{H}_{\rm CD} \approx \frac{g\Omega }{2\Delta} \big(\hat{a}+\hat{a}^\dagger\big)\sigmaz
\end{equation}
We have thus arrived at the desired conditional displacement interaction that we wished to demonstrate, with a CD rate of $g_{\rm CD} = g\Omega/2\Delta$. Note, if we added a phase $\phi$ to the initial qubit drive in Eq. \eqref{eq:CR_CR_initial_eq}, i.e. $\Omega\sigmax\cos(\omega t) \to \Omega\sigmax\cos(\omega t + \phi)$, we would instead have gotten the following:
\begin{equation}
\hat{H}_{\rm CD} \approx \frac{g\Omega }{2\Delta}\bigg[\big(\hat{a}+\hat{a}^\dagger)\cos(\phi) + i(\hat{a}^\dagger -\hat{a})\sin(\phi)\bigg]\sigmaz 
\end{equation}
Therefore, we see that it is possible to generate conditional displacements along both the $X \sim \hat{a}+\hat{a}^\dagger$ and $P \sim i(\hat{a}^\dagger -\hat{a})$ quadratures of the oscillator, just by setting the phase of the drive.

\subsection{Echoed Conditional Displacement (ECD) Gates\label{sec:2_ECD}}

The cross-resonance style CD described above was proposed in the context of circuit QED in Ref. \cite{touzard2019gated} using a transmon control qubit. In practice, though, it invariably also leads to a large \textit{unconditional} displacement of the oscillator in addition to the desired CD interaction, due to (a) additional higher-order Hamiltonian terms that arise and (b) the effect of physically having a strong drive in the system at the oscillator frequency (i.e. crosstalk). This style of CD thus typically also requires a separate ``cancellation drive'' to null out the effective displacement of the oscillator. While not a problem per se, the extra calibration needed here should be kept in mind. 

It turns out, however, that there is a better (in some sense) alternative for realizing CDs that has since been developed in the literature \cite{campagne2020gkp-expt, eickbusch2022fast}. The approach in question is called the echoed conditional displacement (ECD), and it makes use of the dispersive interaction between a qubit and an oscillator that we saw in Sec. \ref{sec:2_control_nonlinearity_drive}. The starting point for ECD is the dispersive Hamiltonian with an additional cavity and qubit drive for universal control. In the rotating frames of both the qubit and oscillator, and making the usual RWA on the drive terms\footnote{Implicit in this definition of the Hamiltonian is the fact that both drives are taken to be resonant here.}, we get 
\begin{equation}
    \hat{H} = \frac{\chi}{2}\hat{a}^\dagger\hat{a}\sigmaz + \epsilon(t)\hat{a}^\dagger + \epsilon^\ast(t)\hat{a} + \hat{\Omega}_q(t)
\end{equation}
where $\hat{\Omega}_q(t) = \Omega(t)\sigmap + \Omega^\ast(t)\sigmam$ captures the effect of a general qubit drive. The basic idea behind the ECD approach is to use oscillator displacements as a lever arm in phase space. On its own, the dispersive term $(\chi\sigmaz/2)\hat{a}^\dagger\hat{a}$ generates a conditional \textit{rotation} of the oscillator at frequency $\pm \chi/2$, and we can transform this to a conditional \textit{displacement} as follows via a large phase space displacement. Following \cite{eickbusch2022fast}, we transform $\hat{H}$ above into a displaced frame $\hat{a} \mapsto \hat{a} + \alpha(t)$ where $\alpha(t)$ is determined via the response of the oscillator to the drive\footnote{Specifically, $\alpha(t)$ is determined by the solution to the differential equation $\partial_t\alpha(t) = -i\epsilon(t) - (\kappa/2)\alpha(t)$, with $\kappa$ being the single-photon loss rate. This is the so-called \textit{classical response} of the oscillator to a resonant drive.}. This gives
\begin{equation}
    \hat{H} = \frac{\chi}{2}\hat{a}^\dagger\hat{a}\sigmaz + \frac{\chi}{2}\Big[\alpha(t)\hat{a}^\dagger + \alpha^\ast(t)\hat{a}\Big]\sigmaz + \frac{\chi}{2}|\alpha(t)|^2\sigmaz +  \hat{\Omega}_q(t)
    \label{eq:ECD_disp_frame_H}
\end{equation}
Here, the third term is a Stark-shift of the qubit (i.e. an $\alpha$-dependent frequency shift) while the first and second terms give the new qubit-oscillator interaction in this displaced frame \cite{murch2012cavity, eddins2018stroboscopic}. If $\alpha_{\rm max} = \max|\alpha(t)|$ is large enough, then the second term will dominate over the first and result in the effective qubit-oscillator coupling having the form of a conditional displacement: 
\begin{equation}
    \hat{H} \approx \Big[g_{\rm CD}(t)\hat{a}^\dagger + g_{\rm CD}^\ast(t)\hat{a}\Big]\sigmaz
\end{equation}
with $g_{\rm CD}(t) = \chi\alpha(t)/2$ and a maximum CD rate given by $\chi\alpha_{\rm max}/2$. Of course, we can't just ignore the other terms and so must somehow find a way to cancel them out. The strategy adopted in ECD is to use an ``echo'' sequence which consists of a qubit $\pi$-pulse halfway through the evolution [$\ev\sigmaz \to -\ev\sigmaz$] and a flip on the displacement sign $\alpha(t) \to -\alpha(t)$. Intuitively, this can be understood to cancel out all terms in Eq. \eqref{eq:ECD_disp_frame_H} besides the second, which is proportional to $\alpha\sigmaz$ and thus unaffected by the echo, leaving just the desired CD term. More rigorously, there is an exact trajectory in phase space that needs to be implemented via $\epsilon(t)$ and $\Omega(t)$ in order to cancel the unwanted terms, and it can be calculated by solving the Schr\"odinger equation for a given target operation \cite{eickbusch2022fast}. In practice, for finite bandwidth pulses, this typically requires some numerical optimization to compute the correct pulse schedules. In the end, the ECD gate implements the following unitary:
\begin{equation}
    {\rm ECD}(\beta) = \hat{D}\bigg(\frac{+\beta}{2}\bigg)\op{e}{g} + \hat{D}\bigg(\frac{-\beta}{2}\bigg)\op{g}{e}
\end{equation}
The time taken to realize a conditional displacement of $\beta$ is approximately $\beta / (\chi\alpha_{\rm max})$, and so it is important to use as large of an intermediate photon number $\alpha_{\rm max}$ as possible to get fast CDs. However, in experiments, there are almost always additional loss channels or unwanted Hamiltonian terms that get activated at large photon numbers, and in practice there is a limit on how large $\alpha_{\rm max}$ can be made before things break. Determining this limit is highly nontrivial; previous GKP experiments have attempted to minimize these effects by working in the low $\chi$ regime (kHz level) in order to minimize the strength of unwanted nonlinear terms, such as the oscillator's inherited Kerr nonlinearity \cite{campagne2020gkp-expt, eickbusch2022fast, sivak2023gkp-expt, nordquantique2023gkp-expt}. 

% \begin{figure}
%     \centering
%     % \includegraphics{}
%     \caption{\todo{make ECD figure}}
%     \label{fig:2_ECD_pulse_sequence}
% \end{figure}



% \clearpage
% \section{QEC Simulations with SBS \label{sec:2_simulations_SBS}}

% \subsection{Simulations with SBS: I. Oscillator Single-Photon Loss}  

% \subsection{Simulations with SBS: II. Control Qubit Error Channels}